# TimePerk Cortex (Laravel 11 + React 18 with Docker Compose)

**TimePerk Cortex - The brain behind your team's time** is a **Multi-Tenant Timesheet and Expense Management System** built with **Laravel 11 API + React 18 SPA**, fully containerized with **Docker Compose**.  
The project is **automatically generated by GitHub Copilot Workspace** and validated using **GitHub Actions CI**.

---

## üìå Purpose

The system allows:
- **Multi-tenant architecture** with isolated databases per tenant (Stancl Tenancy)
- Recording and approving **working hours per project** via calendar interface
- Submitting and approving **project-related expenses** via multi-stage workflow
- Managing users with **3-tier role system**: Technician, Manager, and Admin
- **Triple-role per project**: Independent timesheet, expense, and finance manager roles
- **Professional authorization** with 17 granular permissions and Laravel Policies
- **Intelligent rate limiting** (200/min read, 30/min create, 10/min approve)
- Viewing **interactive dashboards** with 6 Recharts visualizations and analytics

---

## üè¢ Multi-Tenancy Architecture

**TimePerk Cortex** supports true multi-tenant SaaS architecture:

### Tenant Isolation
- **Database Separation**: Each tenant has isolated database `timesheet_{tenant_slug}`
- **Hybrid Mode**: Subdomain-based (production) + X-Tenant header (local/dev)
- **Automatic Resolution**: Stancl Tenancy middleware with AllowCentralDomainFallback
- **Central Database**: Stores tenant metadata and global migrations

### Active Tenants
- `slugcheck`: Testing tenant
- `test-company`: Demo tenant with sample data

### Demo Credentials
```
Email: admin@testcompany.test
Tenant: test-company
Password: admin123
```

**Frontend Login**: Click "Owner" demo button on login page

---

## üß© MySQL Grants (Multi-Tenancy) ‚Äì Quick Fix

If tenant creation fails with:
`Access denied for user 'timesheet'@'%' to database 'timesheet_<...>'` during `CREATE DATABASE`.

### Reset everything (dev only)
```bash
docker-compose down -v && docker-compose up -d --build
```

### Verify grants
```bash
docker-compose exec -T database mysql -u root -proot -e "SHOW GRANTS FOR 'timesheet'@'%';"
```

Expected to include:
- `GRANT CREATE ON *.* TO 'timesheet'@'%'`
- `GRANT ALL PRIVILEGES ON \`timesheet_%\`.* TO 'timesheet'@'%'`

Notes:
- Grants are applied automatically on fresh DB init via `docker/mysql/init.sql` (mounted into `/docker-entrypoint-initdb.d`).
- `docker-compose down -v` deletes the MySQL volume (data + grants). The next `up` re-applies them.

More details: [docs/DATABASE_PERMISSIONS.md](docs/DATABASE_PERMISSIONS.md)

---

## üîê Professional Authorization System

**TimePerk Cortex** implements enterprise-grade security and authorization:

### Role-Based Access Control (RBAC)
- **3 Global Roles**: Technician, Manager, Admin
- **3 Project Roles**: Independent `project_role`, `expense_role`, `finance_role` per user per project
- **17 Granular Permissions**: create-timesheets, approve-timesheets, manage-projects, etc.
- **Laravel Policies**: TimesheetPolicy, ExpensePolicy for ownership and status-based rules
- **Spatie Laravel Permission**: Industry-standard package for role and permission management

### Security Features
- **Middleware Protection**: CheckPermission middleware on all API routes
- **Granular Rate Limiting**: Read (200/min), Create (30/min), Edit (20/min), Critical (10/min)
- **Form Requests**: Professional validation with StoreTimesheetRequest and UpdateTimesheetRequest
- **API Authorization**: Every response includes permission data for frontend UI control
- **Ownership Rules**: Technicians access only their records, Managers access team + own
- **Status Protection**: Cannot edit/delete approved/closed records (Admin override available)
- **Multi-Tenant Security**: Tenant context enforced on all queries via global scopes

### Role-Specific Validation Rules (Updated 2025-11-12)

| Role | View Access | Validation Rights | Project Management |
|------|-------------|-------------------|-------------------|
| **Technician** | ‚úÖ Own timesheets only | ‚ùå Cannot validate any records | ‚ùå No project access |
| **Manager** | ‚úÖ Own projects + team records (members only, not other managers) | ‚úÖ Can approve/reject timesheets/expenses from members | ‚úÖ Assigned via `project_members.project_role = 'manager'` |
| **Finance Manager** | ‚úÖ Finance stage expenses only | ‚úÖ Can approve finance review/approved stages | ‚úÖ Assigned via `project_members.finance_role = 'manager'` |
| **Admin** | ‚úÖ All system records | ‚úÖ Can validate all timesheets/expenses | ‚úÖ Full system access |

**Implementation Details**:
- **Triple-Role System**: `project_members` table with `project_role`, `expense_role`, `finance_role`
- **Policy Validation**: Policies check project membership + role segregation
- **Manager Segregation**: Managers cannot view/edit/approve other managers' records
- **Controller Authorization**: `$this->authorize('approve', $timesheet)` in approve/reject methods

---

## üõ†Ô∏è Admin Panel (New - November 2025)

**TimePerk Cortex** includes a complete administration panel for managing master data:

### Features
- **Full CRUD Operations**: Create, Read, Update, Delete for all master tables
- **MUI DataGrid Integration**: Professional tables with pagination, sorting, and filtering
- **4 Management Modules**:
  - **Projects**: Manage projects with status tracking (Active/Completed/On Hold)
  - **Tasks**: Task management with optional project assignment
  - **Locations**: Work location management
  - **Users**: Team member and user account management (with payroll identifiers)
- **Color-Coded Design**: Each module has its own color theme for visual clarity
- **Mobile Responsive**: All admin pages adapt to mobile devices
- **Role Protection**: Admin panel visible only to users with Admin role

### Access Credentials (Updated 2025-11-12)
```
Tenant: test-company
Email: admin@testcompany.test
Password: admin123
‚ö†Ô∏è Change password in production!
```

**Note**: Use "Owner" demo button on login page for quick access.

### Admin Routes
- `/admin` - Admin Dashboard with module cards
- `/admin-projects` - Projects CRUD manager
- `/admin-tasks` - Tasks CRUD manager
- `/admin-locations` - Locations CRUD manager
- `/admin-users` - Users CRUD manager

### Technical Implementation
- **Components**: AdminLayout, AdminDashboard, ProjectsManager, TasksManager, LocationsManager, UsersManager
- **Authorization**: `isAdmin()` check in AuthContext, menu hidden for non-admins
- **Navigation**: Administration submenu in SideMenu (collapsible section)
- **Seeder**: `AdminUserSeeder` creates default admin account
- **Documentation**: See `docs/ADMIN_PANEL_IMPLEMENTATION.md` for complete guide

---

## üîÑ Multi-Tenancy & Rate Limiting

### Multi-Tenant Architecture (Updated 2025-11-12)
**Stancl Tenancy with Hybrid Mode**:
- **Production**: Subdomain-based tenant resolution (`{tenant}.timeperk.app`)
- **Development**: X-Tenant header for local testing (`X-Tenant: test-company`)
- **Database Isolation**: Each tenant has separate database `timesheet_{slug}`
- **Central Database**: `timesheet` stores tenant metadata
- **Automatic Fallback**: AllowCentralDomainFallback middleware for localhost

**Environment Configuration**:
```env
TENANCY_ALLOW_CENTRAL_FALLBACK=true
TENANCY_FALLBACK_ENVIRONMENTS=local,development,testing
CENTRAL_DOMAINS=127.0.0.1,localhost,app.timeperk.localhost
TENANCY_HEADER=X-Tenant
```

**Testing Multi-Tenancy**:
```bash
# Local development (header mode)
curl -H "X-Tenant: test-company" http://localhost:8080/api/projects

# Production (subdomain mode)
curl http://test-company.timeperk.app/api/projects
```

### Tenant Migration Baseline (existing tenant DB)
- Use when a tenant database already has tables but the migrations table is missing history.
- Run inside the app container:
```bash
docker-compose exec app php artisan tenant:baseline-migrations demo --batch=1
docker-compose exec app php artisan tenants:migrate demo
```
- Safe to rerun; it only inserts missing migration rows. Replace `demo` with the target tenant slug.

### Intelligent Rate Limiting (Optimized 2025-11-12)
**Granular throttle limits designed for intensive navigation**:

| Operation | Limit | Middleware | Routes |
|-----------|-------|------------|--------|
| **Read** | 200/min | `throttle:read` | All GET requests (expenses, timesheets, projects, etc.) |
| **Create** | 30/min | `throttle:create` | All POST requests (create records) |
| **Edit** | 20/min | `throttle:edit` | All PUT/PATCH requests (update records) |
| **Delete** | 10/min | `throttle:delete` | All DELETE requests |
| **Critical** | 10/min | `throttle:critical` | Approve/reject/close operations |
| **Login** | 5/min | `throttle:login` | Login endpoint (security) |
| **API General** | 120/min | `throttle:api` | Global API wrapper |

**Benefits**:
- ‚úÖ **Fast Navigation**: 200 reads/min prevents "Too Many Requests" errors
- ‚úÖ **Security**: Login (5/min) and critical operations (10/min) protected
- ‚úÖ **Performance**: Separate limits avoid blocking read operations
- ‚úÖ **User Experience**: Supports rapid page switching without errors

**Implementation**:
- Rate limiters: `backend/app/Providers/RouteServiceProvider.php`
- Route middleware: `backend/routes/api.php` (granular throttle on all endpoints)

---

## üöÄ Quick Start

### Prerequisites
- Docker & Docker Compose
- Git

### Initial Setup

```bash
# 1. Clone and start containers
git clone <repository-url>
cd timesheet
docker-compose up -d

# 2. Setup database permissions (REQUIRED for multi-tenancy)
docker-compose exec app php artisan db:setup-permissions

# 3. Run migrations
docker-compose exec app php artisan migrate --seed

# 4. Create first tenant (optional)
docker-compose exec app php artisan tenants:create

# 5. Access the application
# Frontend: http://app.localhost:8082
# API: http://api.localhost
```

### Common Commands

```bash
# Check database permissions
docker-compose exec app php artisan db:setup-permissions

# Force permission reconfiguration
docker-compose exec app php artisan db:setup-permissions --force

# Create tenant database
docker-compose exec app php artisan tenants:migrate <tenant-slug>

# Rebuild containers after code changes (IMPORTANT!)
docker-compose down -v && docker-compose up -d --build
```

---

## ‚öôÔ∏è Technical Architecture

### Docker Services

| Service | Container | Port | Description |
|---------|-----------|------|-------------|
| **Backend API** | Laravel 11 + PHP-FPM 8.3 | 80 | REST API with Sanctum + Stancl Tenancy + Spatie Permission |
| **Frontend SPA** | React 18 + Vite + Node 20 | 3000 | Calendar & grid interface with multi-tenant support |
| **Database** | MySQL 8.0 | 3306 | Multi-tenant with isolated databases per tenant |
| **Cache** | Redis Alpine | 6379 | Session, cache & rate limiting storage |
| **Web Server** | Nginx Alpine | 80 | Reverse proxy for Laravel |

**Access Points**:
- Frontend: `http://localhost:3000`
- Backend API: `http://localhost:8080/api`
- MySQL: `localhost:3307` (user: `timesheet`, pass: `secret`)
  - Central DB: `timesheet`
  - Tenant DBs: `timesheet_slugcheck`, `timesheet_test-company`

### Database Permissions (Multi-Tenancy)

**Critical**: The `timesheet` MySQL user needs special permissions to create tenant databases:

```bash
# Automated setup (recommended)
docker-compose exec app php artisan db:setup-permissions

# Manual setup (if command fails)
docker-compose exec database mysql -u root -proot < docker/mysql/init.sql
```

**Permissions granted**:
- ‚úÖ `CREATE ON *.*` - Create new tenant databases
- ‚úÖ `ALL ON timesheet_%.*` - Full access to tenant databases
- ‚úÖ `ALL ON timesheet.*` - Full access to central database

These permissions are automatically applied on first container start via `docker/mysql/init.sql`.

goals:
  - "Generate backend in /backend with Laravel 11 + Sanctum + MySQL"
  - "Generate frontend in /frontend with React TS, MUI, React Query, FullCalendar"
  - "Implement timesheets calendar CRUD + expenses grid CRUD + bulk approve/reject"
  - "Enforce read-only on Approved entries"
  - "Seed demo data and provide run instructions"

rules:
  - "Do not ask for input. Assume defaults."
  - "Auto-continue if a step is incomplete."
  - "Code must run locally (backend 8000, frontend 5173)."

steps:
  - name: "Backend scaffold"
    run:
      - "composer create-project laravel/laravel backend"
      - "cd backend && composer require laravel/sanctum"
      - "cd backend && php artisan vendor:publish --provider=\"Laravel\\Sanctum\\SanctumServiceProvider\""
      - "cd backend && php artisan migrate"

  - name: "Backend domain"
    description: "Migrations, models, seeders, policies, controllers, routes for entities."
    code: |
      // Create migrations/models for: Technician, Project, TaskType, Timesheet, Expense
      // Add enums/status fields; FKs; indexes
      // Policies + middleware to block edits if status='Approved'
      // FormRequests for validation; API Resources for DTOs
      // Controllers: Auth, Projects, TaskTypes, Timesheets (+bulk), Expenses (+bulk)
      // routes/api.php: REST endpoints under /api

  - name: "Frontend scaffold"
    run:
      - "npm create vite@latest frontend -- --template react-ts"
      - "cd frontend && npm i axios @tanstack/react-query react-router-dom @mui/material @mui/icons-material @emotion/react @emotion/styled @fullcalendar/react @fullcalendar/daygrid @fullcalendar/timegrid @fullcalendar/interaction"

  - name: "Frontend pages"
    description: "Implement calendar/grid pages and modals."
    files:
      - path: "frontend/src/pages/Timesheets.tsx"
        content: "// FullCalendar wired to API with select/eventClick -> modal CRUD; approved entries disabled"
      - path: "frontend/src/pages/Expenses.tsx"
        content: "// MUI DataGrid with double-click -> modal; bulk approve/reject toolbar; disable approved rows"

  - name: "Verify"
    run:
      - "cd backend && php artisan test || echo 'No tests yet ‚Äî backend build check only'"
      - "cd frontend && npm run build"

  - name: "Done"
    message: "PROJECT GENERATION COMPLETE ‚Äî READY TO RUN"

# Guidance carried over for agents (optional, unchanged)
guidance:
  domain_specifics: |
    Minimal business workflow:
    - Technicians submit timesheets and expenses per project.
    - Project Managers approve or reject them.
    Approved entries are immutable. No multi-step escalation or ERP checks.
  extension_patterns: |
    Extend by modifying code (backend/controllers, frontend/pages/components).
    Do not modify this config unless the solution architecture changes.
  environment_setup: |
    Requirements:
      - PHP 8.3 + Composer
      - Node 20+ and npm
      - MySQL 8
      - Sanctum SPA origin: http://localhost:5173
  testing_strategy: |
    Backend: PHPUnit controller/policy tests
    Frontend: optional (React Testing Library / Vitest)


‚∏ª

2) .copilot/hooks/post-run.sh ‚Äî replace whole file

#!/usr/bin/env bash
# Copilot Workspace Post-Run Hook ‚Äî Laravel + React
# Logs session results, validates backend/frontend, optionally triggers CI, and appends a Markdown entry.

LOG_DIR="./logs"
LOG_FILE="$LOG_DIR/session_$(date +'%Y%m%d_%H%M%S').log"
CONTEXT_FILE="./docs/ai/ai_context.json"
CI_WORKFLOW=".github/workflows/build.yml"
SUMMARY_FILE=".copilot/hooks/session-log-summary.md"

echo ""
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
echo "üìÑ Copilot Post-Run Hook: Session Summary"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"

mkdir -p "$LOG_DIR"

# Context summary
if [ -f "$CONTEXT_FILE" ]; then
  if command -v jq >/dev/null 2>&1; then
    NAME=$(jq -r '.context_name' "$CONTEXT_FILE")
    DOMAIN=$(jq -r '.domain.scope' "$CONTEXT_FILE")
    FRAMEWORK=$(jq -r '.architecture.framework // "Laravel + React"' "$CONTEXT_FILE")
    echo "üß† Context used: $NAME ($DOMAIN | $FRAMEWORK)"
    echo "Context: $NAME ($DOMAIN | $FRAMEWORK)" >> "$LOG_FILE"
  else
    echo "üß† Context file detected (install jq to parse details)."
    echo "Context: Detected (no jq)" >> "$LOG_FILE"
  fi
else
  echo "‚ö†Ô∏è  Context file not found."
  echo "Context: Missing" >> "$LOG_FILE"
fi

# Backend validation (Laravel)
BUILD_STATUS="Skipped"
if [ -d "./backend" ]; then
  echo "üîç Checking Laravel backend..."
  pushd backend >/dev/null 2>&1
  php -v >/dev/null 2>&1 && composer --version >/dev/null 2>&1
  if [ $? -eq 0 ]; then
    php artisan --version >/dev/null 2>&1
    if [ $? -eq 0 ]; then
      echo "‚úÖ Laravel environment OK"
      BUILD_STATUS="Laravel OK"
      # Minimal syntax check: run a lightweight command
      php artisan list >/dev/null 2>&1
    else
      echo "‚ùå Laravel check failed."
      BUILD_STATUS="Laravel Failed"
    fi
  else
    echo "‚ö†Ô∏è  PHP/Composer not available in this runner."
    BUILD_STATUS="Env Missing"
  fi
  popd >/dev/null 2>&1
fi

# Frontend validation (React)
FRONT_STATUS="Skipped"
if [ -d "./frontend" ]; then
  echo "üîç Building React frontend..."
  pushd frontend >/dev/null 2>&1
  if command -v npm >/dev/null 2>&1; then
    npm run build >/dev/null 2>&1
    if [ $? -eq 0 ]; then
      echo "‚úÖ React build OK"
      FRONT_STATUS="React OK"
    else
      echo "‚ùå React build failed"
      FRONT_STATUS="React Failed"
    fi
  else
    echo "‚ö†Ô∏è  npm not available."
    FRONT_STATUS="Env Missing"
  fi
  popd >/dev/null 2>&1
fi

# Persist statuses
echo "Build: $BUILD_STATUS / $FRONT_STATUS" >> "$LOG_FILE"

# Optional CI trigger
if [ -f "$CI_WORKFLOW" ]; then
  echo "‚öôÔ∏è  CI workflow detected. Triggering build..."
  if command -v gh >/dev/null 2>&1; then
    gh workflow run build.yml >/dev/null 2>&1
    if [ $? -eq 0 ]; then
      echo "üöÄ CI workflow triggered successfully."
      echo "CI: Triggered" >> "$LOG_FILE"
    else
      echo "‚ö†Ô∏è  CI trigger failed ‚Äî check GitHub CLI authentication."
      echo "CI: Failed" >> "$LOG_FILE"
    fi
  else
    echo "‚ÑπÔ∏è  GitHub CLI not found ‚Äî skipping CI trigger."
    echo "CI: Skipped" >> "$LOG_FILE"
  fi
else
  echo "‚ÑπÔ∏è  No GitHub Actions workflow found."
  echo "CI: None" >> "$LOG_FILE"
fi

# Timestamp and log save
echo "Timestamp: $(date)" >> "$LOG_FILE"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ" >> "$LOG_FILE"
echo "‚úÖ Session summary saved to $LOG_FILE"

# Append to Markdown summary
DATE_TIME=$(date +'%Y-%m-%d %H:%M:%S')
if [ -f "$SUMMARY_FILE" ]; then
  echo "üóÇ Appending entry to $SUMMARY_FILE..."
  {
    echo "### üïí Session ‚Äî $DATE_TIME"
    if [ -f "$CONTEXT_FILE" ] && command -v jq >/dev/null 2>&1; then
      NAME=$(jq -r '.context_name' "$CONTEXT_FILE")
      DOMAIN=$(jq -r '.domain.scope' "$CONTEXT_FILE")
      FRAMEWORK=$(jq -r '.architecture.framework // "Laravel + React"' "$CONTEXT_FILE")
      echo "**Context:** $NAME ($DOMAIN | $FRAMEWORK)  "
    else
      echo "**Context:** Unknown  "
    fi
    LAST_BUILD=$(grep '^Build:' "$LOG_FILE" | tail -1 | cut -d':' -f2- | xargs)
    LAST_CI=$(grep '^CI:' "$LOG_FILE" | tail -1 | cut -d':' -f2- | xargs)
    echo "**Build:** ${LAST_BUILD:-N/A}  "
    echo "**CI:** ${LAST_CI:-N/A}  "
    echo "**Notes:**"
    echo "- Automatic session logged by post-run hook."
    echo "- See $LOG_FILE for details."
    echo ""
    echo "---"
    echo ""
  } >> "$SUMMARY_FILE"
  echo "‚úÖ Markdown summary updated."
else
  echo "‚ö†Ô∏è  $SUMMARY_FILE not found ‚Äî skipping summary append."
fi

echo ""
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
echo "‚úÖ Copilot Post-Run Hook completed"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
echo ""


‚∏ª

3) /docs/ai/ai_context.json ‚Äî update architecture & stack

{
  "context_name": "TimePerk_AI_Context",
  "version": "1.1",
  "description": "Operational and architectural context for AI agents extending the TimePerk project (Laravel + React).",
  "domain": {
    "scope": "Timesheet and Expense Management",
    "workflow": [
      "Technician submits timesheet and expenses",
      "Project Manager approves or rejects entries"
    ],
    "constraints": [
      "Approved entries are immutable",
      "No multi-level approval chains",
      "No ERP integration in MVP"
    ]
  },
  "architecture": {
    "framework": "Laravel 11 (PHP 8.3) + React 18 (Vite + TypeScript)",
    "backend": "Laravel 11 API with Sanctum, Eloquent, Policies, FormRequests",
    "frontend": "React 18 SPA (Vite + TS), MUI, React Query, FullCalendar",
    "projects": {
      "backend": "API, Auth, Controllers, Migrations, Seeders",
      "frontend": "SPA pages/components (Calendar & Grid)",
      "docs": "Context and developer guides"
    },
    "database": {
      "type": "MySQL 8",
      "connection_string_hint": "DB_HOST=127.0.0.1; DB_PORT=3306; DB_DATABASE=timesheet; DB_USERNAME=root; DB_PASSWORD=secret"
    },
    "authentication": {
      "method": "Laravel Sanctum (SPA)",
      "roles": ["Technician", "Manager"]
    }
  },
  "environment": {
    "requirements": [
      "PHP 8.3 and Composer",
      "Node 20+ and npm",
      "MySQL 8",
      "Sanctum SPA origin: http://localhost:5173"
    ],
    "restrictions": [
      "Local development first",
      "No Docker/Azure required in MVP"
    ]
  },
  "extension_rules": {
    "do_not_edit": [".copilot/config.yml"],
    "allowed_actions": [
      "Modify Laravel controllers, models, migrations, policies",
      "Modify React pages/components and API clients",
      "Add new modules via code (entity + controller + page + modal)"
    ],
    "code_standards": [
      "PSR-12 (PHP), ESLint+Prettier (TS)",
      "Async/await on frontend requests",
      "Avoid unnecessary dependencies"
    ],
    "feature_pattern_example": {
      "module": "LeaveManagement",
      "steps": [
        "Add entity & migration (backend)",
        "Add controller + routes + policy",
        "Add React page + modal + API client",
        "Add seed/demo data",
        "Run tests and CI"
      ]
    }
  },
  "testing": {
    "strategy": [
      "PHPUnit for controllers/policies",
      "Optional: React tests with Vitest/RTL"
    ],
    "ci_integration": "GitHub Actions build.yml runs PHP tests and React build"
  },
  "agent_behavior": {
    "rules": [
      "Do not ask clarification questions",
      "Continue automatically if output is partial",
      "Preserve architecture and naming consistency",
      "Validate backend and frontend build after changes"
    ],
    "output_validation": [
      "php artisan list succeeds",
      "npm run build succeeds",
      "Approved items are immutable by API and UI"
    ]
  },
  "meta": {
    "author": "DRPrompt",
    "techniques": ["Constraint-based", "Chain-of-Thought", "Self-checking"],
    "license": "MIT",
    "last_updated": "2025-11-03"
  }
}


‚∏ª

4) .github/workflows/build.yml ‚Äî new GitHub Actions for PHP + Node

name: Build & Test (Laravel + React)

on:
  push:
    branches: [ main, master, develop ]
  pull_request:

jobs:
  backend:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup PHP 8.3
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.3'
          extensions: mbstring, intl, pdo_mysql
          coverage: none

      - name: Install Composer deps
        run: |
          cd backend
          composer install --no-interaction --prefer-dist --no-progress
          cp .env.example .env || true
          php artisan key:generate
      - name: Run PHPUnit (if present)
        run: |
          cd backend
          php artisan test || echo "No tests yet ‚Äî skipped"

  frontend:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node 20
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install & Build
        run: |
          cd frontend
          npm ci
          npm run build


‚∏ª

5) README.md ‚Äî update for Laravel + React

# TimePerk (Laravel 11 + React 18)

**Timesheet & Expense Management** built with **Laravel 11 (Sanctum)** and **React 18 (Vite + TypeScript)**.  
UI behavior:
- **Timesheets** on a **calendar** (FullCalendar). Click/drag opens a CRUD modal. Approved entries are read-only.
- **Expenses** in a **grid** (MUI DataGrid). Double-click opens a CRUD modal. Bulk approve/reject via toolbar.
- **Master data**: Projects, TaskTypes, Technicians (basic CRUD).

## Stack
- **Backend:** Laravel 11, PHP 8.3, MySQL 8, Sanctum, Eloquent, Policies, FormRequests  
- **Frontend:** React 18 (Vite + TS), MUI, React Query, FullCalendar  
- **Auth:** SPA with Sanctum (roles: Technician, Manager)  
- **CI:** GitHub Actions ‚Äî PHP (tests) + Node (build)

## Local Setup

### Backend
```bash
cd backend
cp .env.example .env
# set DB_* for MySQL 8 (create database beforehand)
php artisan key:generate
php artisan migrate --seed
php artisan serve --port=8000

Frontend

cd frontend
npm install
npm run dev

Open:
	‚Ä¢	API: http://localhost:8000
	‚Ä¢	SPA: http://localhost:5173

Sanctum: set SANCTUM_STATEFUL_DOMAINS=localhost:5173 and configure CORS to allow the SPA origin.

Roles & Rules
	‚Ä¢	Technician: create/edit own timesheets and expenses until approved; submit for approval.
	‚Ä¢	Manager: approve/reject single or multiple rows; approved entries become immutable (API + UI).

Pages
	‚Ä¢	/login, /dashboard
	‚Ä¢	/timesheets ‚Äî FullCalendar (month/week/day) with select/eventClick/drag resize
	‚Ä¢	/expenses ‚Äî DataGrid with double-click modal + bulk actions
	‚Ä¢	/masters/projects, /masters/tasks ‚Äî basic CRUD

Development Notes
	‚Ä¢	Use PSR-12 (PHP) and ESLint/Prettier (TS).
	‚Ä¢	Prefer async/await and React Query for data fetching.
	‚Ä¢	Approved records must be blocked server-side (Policy/Middleware) and disabled in the UI.

CI

GitHub Actions workflow at .github/workflows/build.yml:
	‚Ä¢	Backend: Composer install, key generate, PHPUnit (if present)
	‚Ä¢	Frontend: Node 20, npm ci, npm run build

---

## üìö Documentation

### User Guides
- **[Admin Panel Guide](docs/ADMIN_PANEL_GUIDE.md)** - User-facing documentation for administration features
- **[Admin Panel Implementation](docs/ADMIN_PANEL_IMPLEMENTATION.md)** - Technical implementation guide

### Developer Guides
- **[Development Guidelines](docs/DEVELOPMENT_GUIDELINES.md)** - Coding standards and best practices
- **[Developer Guide](README_DEV_GUIDE.md)** - Human developer guide with extension patterns
- **[AI Developer Guide](docs/ai/README_DEV_GUIDE_AI.md)** - Concise AI agent operational guide

### Architecture & Context
- **[AI Context](docs/ai/ai_context.json)** - Machine-readable context for automated agents
- **[Technical Specifications](docs/ai/TECHNICAL_SPECIFICATIONS.md)** - Detailed technical documentation

### Multi-Tenancy
- **[Database Permissions](docs/DATABASE_PERMISSIONS.md)** - ‚ö†Ô∏è **CRITICAL** Setup guide for multi-tenant database permissions (recurring issue)
- **[Multi-Database Tenancy Fixes](docs/MULTI_DATABASE_TENANCY_FIXES.md)** - ‚úÖ **NEW** Critical fixes for multi-DB tenancy (3/3 tests passing)
- **[Local Tenancy](docs/local_tenancy.md)** - Header/query-based tenant resolution for local development

### Change Logs
- **[Improvements Log](IMPROVEMENTS_LOG.md)** - Portuguese changelog
- **[Implemented Improvements](docs/IMPLEMENTED_IMPROVEMENTS.md)** - Complete feature log in English

---

## License

MIT

---

## That‚Äôs it
- Files **updated**:  
  - `.copilot/config.yml`  
  - `.copilot/hooks/post-run.sh`  
  - `/docs/ai/ai_context.json`  
  - `README.md`  

- File **added**:  
  - `.github/workflows/build.yml`  

All other scripts/hooks/logs we created earlier can remain as-is. If you want, I can also generate **starter stubs** (migrations, models, controllers, minimal React pages) to paste in immediately.
