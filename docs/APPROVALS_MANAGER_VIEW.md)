# üß≠ TimePerk Approvals Manager View ‚Äî Functional Design

**Version:** 1.0  
**Last Update:** 2025-11-09  
**Author:** TimePerk UX / AI Team

---

## üéØ Objective
Provide managers and administrators with a **hybrid validation interface** for reviewing, filtering, and approving timesheet entries in bulk.  
The module merges a **multi-technician calendar** and a **smart validation grid**, enhanced by **AI Cortex** cognitive feedback.

---

## üß± 1Ô∏è‚É£ Core Concepts

### Dual Mode Interface
- **Calendar Manager** ‚Äì visual overview of workload, anomalies, and submission state.  
- **Table Validations** ‚Äì detailed grid for mass actions and data exports.

Users can switch between modes via a **toggle at the top right** of the screen.

[ Calendar | Table ]  ‚Üê toggle

### Shared Data Layer
Both modes use the same data endpoint:

GET /api/timesheets/manager-view?date_from=YYYY-MM-DD&date_to=YYYY-MM-DD&with_ai_summary=true

The API returns:
- List of entries with validation & AI metadata.
- Aggregated summary (counts, averages) for the dashboard header.

---

## üìÖ 2Ô∏è‚É£ Calendar Manager Mode

### Layout
- **Multi-resource view:** one lane per technician.  
- **Badges:**  
  - üß† AI Flagged  
  - üî¥ > 12 hours  
  - ‚ö° Overlap  
  - üü£ Weekend  

### Controls
| Element | Function |
|----------|-----------|
| Multi-select Technician Combo | Filters visible resources. |
| Date Range Picker | Limits calendar scope. |
| Legend / Help Buttons | Opens color-code and badge explanations. |
| View Switch | Week / Month / Timeline toggle. |

### Behavior
- Clicking an event opens a **snapshot modal** (task, project, location, AI score, notes).  
- Hover shows tooltip with summary and anomaly reason.  
- Dragging across days allows multi-selection ‚Üí batch approve/reject.

---

## üßæ 3Ô∏è‚É£ Table Validations Mode

### Layout
Smart DataGrid (MUI DataGrid Pro):

| Column | Type | Notes |
|---------|------|-------|
| **Status** | Icon + color | üü¢ Validated / ‚ö™ Pending / üî¥ Rejected |
| **User** | Text | Technician name |
| **Week** | Numeric | ISO Week Number |
| **Date** | Date | Localized format |
| **Start / End** | Time | HH:mm |
| **Hours** | Decimal | Computed duration |
| **Project / Task / Location** | Text | Join from relations |
| **Description** | Truncated + hover tooltip |
| **AI Score** | Bar + color chip | Tooltip with feedback summary |

### Bulk Action Bar

[‚úÖ Validate] [üö´ Invalidate] [üóë Delete] [‚¨á Export]

Grouping and filtering supported:
- Drag column header ‚Üí group by Technician / Project.
- Filters: date, project, task, status, AI flag.

### Expanded Row (Snapshot)
Clicking a row expands an inline card:

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Task: Frontend Dev ‚Ä¢ Loc: Lisbon           ‚îÇ
‚îÇ AI Score 0.83 ‚ö† ‚ÄúUnusual time pattern.‚Äù    ‚îÇ
‚îÇ Notes: ‚ÄúHomepage layout redesign.‚Äù         ‚îÇ
‚îÇ History: 2025-10-30 ‚Üí 6 h OK; 10-31 ‚Üí 8 h OK ‚îÇ
‚îÇ [View on Calendar] [Open Details]          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

---

## üß† 4Ô∏è‚É£ AI Cortex Integration

### Per-Row Indicators
| Range | Color | Meaning |
|--------|--------|----------|
| 0.00‚Äì0.40 | üü¢ | Consistent pattern |
| 0.41‚Äì0.70 | üü° | Slight anomaly |
| 0.71‚Äì1.00 | üî¥ | High anomaly (AI flagged) |

Hover ‚Üí tooltip with:

AI Cortex: 0.83 (‚ÄúAnomalous hour range for this technician‚Äù)
Recommendation: Verify project allocation.

### Summary Panel (top of view)
Shows totals and distributions:

AI Alerts 8 | >12 h 3 | Overlaps 2 | Pending 25
Avg AI Score: 0.42 | Validated Today: 15

### API Structure
```json
{
  "data": [
    {
      "id": 351,
      "technician": "Jo√£o Silva",
      "project": "Website Redesign",
      "task": "Frontend Dev",
      "date": "2025-11-03",
      "hours": 8.0,
      "status": "pending",
      "ai_score": 0.83,
      "ai_feedback": ["Unusual hour pattern"],
      "over_12h": false,
      "overlap": true,
      "location": "Lisbon Zone 1",
      "description": "Homepage layout work"
    }
  ],
  "summary": {
    "flagged_count": 4,
    "total_pending": 27,
    "average_ai_score": 0.38
  }
}


‚∏ª

‚öôÔ∏è 5Ô∏è‚É£ Technical Implementation Plan

Step	Task	Component
1Ô∏è‚É£	Create new endpoint /api/timesheets/manager-view	Backend
2Ô∏è‚É£	Reuse <Calendar /> with multiResource prop	Frontend
3Ô∏è‚É£	Implement <ValidationGrid /> using MUI DataGrid Pro	Frontend
4Ô∏è‚É£	Add top-level toggle ‚ÄúCalendar / Table‚Äù	UI Shell
5Ô∏è‚É£	Implement LegendPanel + AISnapshotModal	Shared UI
6Ô∏è‚É£	Connect AI Cortex data (ai_score, ai_feedback)	Backend + Frontend
7Ô∏è‚É£	Persist user filters (localStorage / API preferences)	UX
8Ô∏è‚É£	Optimize caching (React Query / Pinia Query)	Performance


‚∏ª

üß© 6Ô∏è‚É£ UX Extras
	‚Ä¢	Saved Filters: remember technician/project/date range per user.
	‚Ä¢	Keyboard Shortcuts:
	‚Ä¢	V = Validate selected
	‚Ä¢	I = Invalidate selected
	‚Ä¢	E = Export
	‚Ä¢	Color Legend: visible via ‚ÄúLegend‚Äù button.
	‚Ä¢	AI Snapshot Modal: detailed explanation of flagged entries.
	‚Ä¢	Bulk Validation Feedback: confirm modal summarizing results and AI flags.

‚∏ª

üöÄ 7Ô∏è‚É£ Future Enhancements
	‚Ä¢	AI Cortex retraining from confirmed validations.
	‚Ä¢	Manager Analytics Dashboard:
	‚Ä¢	% AI flags per project / user
	‚Ä¢	average approval time
	‚Ä¢	Conversational Assistant:
	‚Ä¢	‚ÄúWhy was Jo√£o Silva‚Äôs entry flagged by AI?‚Äù
	‚Ä¢	‚ÄúShow projects with highest anomaly rate.‚Äù

‚∏ª

‚úÖ Summary

The Approvals Manager view combines:
	‚Ä¢	a multi-technician calendar for macro oversight, and
	‚Ä¢	a data-rich grid for precision and speed.
Powered by AI Cortex, it transforms raw validations into intelligent, explainable decisions.

